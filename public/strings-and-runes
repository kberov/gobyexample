<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Go в примери: Низове и Руни</title>
    <link rel=stylesheet href="site.css">
  </head>
  <script>
      window.onkeydown = (e) => {
          if (e.ctrlKey || e.altKey || e.shiftKey || e.metaKey) {
              return;
          }
          
          if (e.key == "ArrowLeft") {
              window.location.href = 'pointers';
          }
          
          
          if (e.key == "ArrowRight") {
              window.location.href = 'structs';
          }
          
      }
  </script>
  <body>
    <div class="example" id="strings-and-runes">
      <h2><a href="./">Go в примери</a>: Низове и Руни</h2>
      
      <table>
        
        <tr>
          <td class="docs">
            <p>Низът в Go е непроменяем отрязък от байтове. Езикът и
стандартната му библиотека работят с низовете
по-особено – сякаш съдържат текст кодиран в
UTF-8<sup class="footnote-ref" id="fnref:UTF8"><a href="#fn:UTF8">1</a></sup>. В други езици низовете са направени от
„знаци“. В Го за понятието „знак“ се използва думата
руна – <code>rune</code>. Руната е цяло число, което представлява
кодова точка в таблицата Уникод<sup class="footnote-ref" id="fnref:-"><a href="#fn:-">2</a></sup>. Статията
„Низове, байтове, руни и знаци“
(https://go.dev/blog/strings) е добро въведение по
въпроса. TODO: Да преведа и добавя като приложение към
книгата статията https://go.dev/blog/strings</p>

<div class="footnotes">

<hr />

<ol>
<li id="fn:UTF8">UTF-8 – https://bg.wikipedia.org/wiki/UTF-8</li>

<li id="fn:-">Уникод – https://bg.wikipedia.org/wiki/Уникод</li>
</ol>

</div>

          </td>
          <td class="code empty leading">
            
          
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            
          </td>
          <td class="code leading">
            <a href="https://go.dev/play/p/Pm_l0jxx0z8"><img title="Run code" src="play.png" class="run" /></a><img title="Copy code" src="clipboard.png" class="copy" />
          <pre class="chroma"><code><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span></span></span></code></pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            
          </td>
          <td class="code leading">
            
          <pre class="chroma"><code><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;unicode/utf8&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span></span></span></code></pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            
          </td>
          <td class="code leading">
            
          <pre class="chroma"><code><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span></span></span></code></pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            <p><code>s</code> е <code>string</code>, на който е присвоена буквална
стойност, съдържаща думата „здравей“ на тайски.
Буквалните низови стойности в Go са кодиран в
UTF-8 текст. Това означава, че и изходният
програмен код в Го е такъв текст.</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma"><code><span class="line"><span class="cl">    <span class="kd">const</span> <span class="nx">s</span> <span class="p">=</span> <span class="s">&#34;สวัสดี&#34;</span></span></span></code></pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            <p>Тъй като низовете са в същността си <code>[]byte</code> –
отрязък от байтове, следното изявление ще изведе
броя на суровите байтове в низа.</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma"><code><span class="line"><span class="cl">    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;дължина в байтове:&#34;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">s</span><span class="p">))</span></span></span></code></pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            <p>Ако обходим низа байт по байт по следния начин,
можем да видим шестнадесетичните стойности на
байтовете, от който е съставен низът <code>s</code>.</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma"><code><span class="line"><span class="cl">    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%x &#34;</span><span class="p">,</span> <span class="nx">s</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">()</span></span></span></code></pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            <p>За да преброим колко <em>руни</em> (знакове) има в низа,
можем да ползваме пакета <code>utf8</code>. Забележете, че
времето за изпълнение на <code>RuneCountInString</code> зависи
от размера на низа, защото трябва да се разкодира
от UTF-8 всяка буква (руна) последователно. Някои
знаци в тайски съдържат повече от един байт, когато
са представени с кодови точки в UTF-8. Така е и с
български – буквите ни са съставени от двубайтови
последователности. Така че изходът от следното
преброяване може да ви изненада.</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma"><code><span class="line"><span class="cl">    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Брой знаци:&#34;</span><span class="p">,</span> <span class="nx">utf8</span><span class="p">.</span><span class="nf">RuneCountInString</span><span class="p">(</span><span class="nx">s</span><span class="p">))</span></span></span></code></pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            <p><code>range</code> обхожда низовете по особен начин – като
разкодира всеки знак заедно с отстоянието му в низа
– мястото на байта, от който започва знака.</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma"><code><span class="line"><span class="cl">    <span class="k">for</span> <span class="nx">idx</span><span class="p">,</span> <span class="nx">runeValue</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">s</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%#U започва от %d\n&#34;</span><span class="p">,</span> <span class="nx">runeValue</span><span class="p">,</span> <span class="nx">idx</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            <p>Можем да постигнем същото, като използваме функцията <code>utf8.DecodeRuneInString</code> изрично.</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma"><code><span class="line"><span class="cl">    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;\nИзползваме DecodeRuneInString&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">w</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span> <span class="nx">i</span> <span class="o">+=</span> <span class="nx">w</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">runeValue</span><span class="p">,</span> <span class="nx">width</span> <span class="o">:=</span> <span class="nx">utf8</span><span class="p">.</span><span class="nf">DecodeRuneInString</span><span class="p">(</span><span class="nx">s</span><span class="p">[</span><span class="nx">i</span><span class="p">:])</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%#U започва от %d\n&#34;</span><span class="p">,</span> <span class="nx">runeValue</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">w</span> <span class="p">=</span> <span class="nx">width</span></span></span></code></pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            <p>Тук показваме подаването на стойност от вид
<code>rune</code> на функция.</p>

          </td>
          <td class="code leading">
            
          <pre class="chroma"><code><span class="line"><span class="cl">        <span class="nf">examineRune</span><span class="p">(</span><span class="nx">runeValue</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            
          </td>
          <td class="code leading">
            
          <pre class="chroma"><code><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">examineRune</span><span class="p">(</span><span class="nx">r</span> <span class="kt">rune</span><span class="p">)</span> <span class="p">{</span></span></span></code></pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            <p>Оградените в единични кавички стойности са <em>буквална стойност на руна</em>. Можем да сравним стойност от вида руна с буквална таква стойност направо.</p>

          </td>
          <td class="code">
            
          <pre class="chroma"><code><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">r</span> <span class="o">==</span> <span class="sc">&#39;t&#39;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;намерих U+0074 LATIN SMALL LETTER T&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="nx">r</span> <span class="o">==</span> <span class="sc">&#39;ส&#39;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;намерих U+0E2A THAI CHARACTER SO SUA&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre>
          </td>
        </tr>
        
      </table>
      
      <table>
        
        <tr>
          <td class="docs">
            
          </td>
          <td class="code leading">
            
          <pre class="chroma"><code><span class="line"><span class="cl"><span class="gp">$</span> go run strings-and-runes.go
</span></span><span class="line"><span class="cl"><span class="go">дължина в байтове: 18
</span></span></span><span class="line"><span class="cl"><span class="go">e0 b8 aa e0 b8 a7 e0 b8 b1 e0 b8 aa e0 b8 94 e0 b8 b5
</span></span></span><span class="line"><span class="cl"><span class="go">Брой знаци: 6
</span></span></span><span class="line"><span class="cl"><span class="go">U+0E2A &#39;ส&#39; започва от 0
</span></span></span><span class="line"><span class="cl"><span class="go">U+0E27 &#39;ว&#39; започва от 3
</span></span></span><span class="line"><span class="cl"><span class="go">U+0E31 &#39;ั&#39; започва от 6
</span></span></span><span class="line"><span class="cl"><span class="go">U+0E2A &#39;ส&#39; започва от 9
</span></span></span><span class="line"><span class="cl"><span class="go">U+0E14 &#39;ด&#39; започва от 12
</span></span></span><span class="line"><span class="cl"><span class="go">U+0E35 &#39;ี&#39; започва от 15</span></span></span></code></pre>
          </td>
        </tr>
        
        <tr>
          <td class="docs">
            
          </td>
          <td class="code">
            
          <pre class="chroma"><code><span class="line"><span class="cl"><span class="go">Използваме DecodeRuneInString
</span></span></span><span class="line"><span class="cl"><span class="go">U+0E2A &#39;ส&#39; започва от 0
</span></span></span><span class="line"><span class="cl"><span class="go">намерих U+0E2A THAI CHARACTER SO SUA
</span></span></span><span class="line"><span class="cl"><span class="go">U+0E27 &#39;ว&#39; започва от 3
</span></span></span><span class="line"><span class="cl"><span class="go">U+0E31 &#39;ั&#39; започва от 6
</span></span></span><span class="line"><span class="cl"><span class="go">U+0E2A &#39;ส&#39; започва от 9
</span></span></span><span class="line"><span class="cl"><span class="go">намерих U+0E2A THAI CHARACTER SO SUA
</span></span></span><span class="line"><span class="cl"><span class="go">U+0E14 &#39;ด&#39; започва от 12
</span></span></span><span class="line"><span class="cl"><span class="go">U+0E35 &#39;ี&#39; започва от 15</span></span></span></code></pre>
          </td>
        </tr>
        
      </table>
      
      
      <p class="next">
        Следващ пример: <a href="structs" rel="next">Структури</a>.
      </p>
      

    <p class="footer">
      от <a href="https://markmcgranaghan.com">Марк Макгранахан</a> и <a href="https://eli.thegreenplace.net">Ели Бендерски</a> | <a href="https://github.com/mmcgrana/gobyexample">изходен код</a> | <a href="https://github.com/mmcgrana/gobyexample#license">разрешително</a>
    </p>

    </div>
    <script>
      var codeLines = [];
      codeLines.push('');codeLines.push('package main\u000A');codeLines.push('import (\u000A    \"fmt\"\u000A    \"unicode/utf8\"\u000A)\u000A');codeLines.push('func main() {\u000A');codeLines.push('    const s \u003D \"สวัสดี\"\u000A');codeLines.push('    fmt.Println(\"дължина в байтове:\", len(s))\u000A');codeLines.push('    for i :\u003D 0; i \u003C len(s); i++ {\u000A        fmt.Printf(\"%x \", s[i])\u000A    }\u000A    fmt.Println()\u000A');codeLines.push('    fmt.Println(\"Брой знаци:\", utf8.RuneCountInString(s))\u000A');codeLines.push('    for idx, runeValue :\u003D range s {\u000A        fmt.Printf(\"%#U започва от %d\\n\", runeValue, idx)\u000A    }\u000A');codeLines.push('    fmt.Println(\"\\nИзползваме DecodeRuneInString\")\u000A    for i, w :\u003D 0, 0; i \u003C len(s); i +\u003D w {\u000A        runeValue, width :\u003D utf8.DecodeRuneInString(s[i:])\u000A        fmt.Printf(\"%#U започва от %d\\n\", runeValue, i)\u000A        w \u003D width\u000A');codeLines.push('        examineRune(runeValue)\u000A    }\u000A}\u000A');codeLines.push('func examineRune(r rune) {\u000A');codeLines.push('    if r \u003D\u003D \'t\' {\u000A        fmt.Println(\"намерих U+0074 LATIN SMALL LETTER T\")\u000A    } else if r \u003D\u003D \'ส\' {\u000A        fmt.Println(\"намерих U+0E2A THAI CHARACTER SO SUA\")\u000A    }\u000A}\u000A');codeLines.push('');codeLines.push('');
    </script>
    <script src="site.js" async></script>
  </body>
</html>
